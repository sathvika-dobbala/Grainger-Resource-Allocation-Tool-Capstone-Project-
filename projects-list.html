<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>All Projects</title>

  <style>
    :root {
      --primary: #2f6feb;
      --secondary-blue: #f0f4ff;
      --text-muted: #6b7280;
      --border: #e9eaf2;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Helvetica Neue", Arial;
    }

    body {
      margin: 0;
      padding: 24px;
      background: #f7f7fb;
      color: #111;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    h1 {
      font-size: 20px;
      margin: 0;
    }

    .back-link {
      color: var(--primary);
      text-decoration: none;
    }
    .back-link:hover {
      color: #1e50c3;
      text-decoration: underline;
    }

    .card {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 1px 2px rgba(16, 24, 40, 0.06);
    }

    .content {
      padding: 16px;
    }

    .toolbar {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 12px;
    }

    input[type="search"] {
      width: 320px;
      padding: 10px 12px;
      border: 1px solid #dcdde4;
      border-radius: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px 12px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      vertical-align: middle;
    }

    th {
      background: #f9fafb;
      font-weight: 600;
    }

    .badge {
      display: inline-block;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 6px;
    }
    .status-not-started { background: #f3f4f6; }
    .status-in-progress { background: #fff7ed; }
    .status-completed { background: #dcfce7; }

    .empty {
      text-align: center;
      color: var(--text-muted);
      padding: 28px 8px;
    }

    .muted {
      color: var(--text-muted);
      font-size: 12px;
    }

    .pill {
      background: var(--secondary-blue);
      color: var(--primary);
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
    }

    button {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid var(--primary);
      background: var(--primary);
      color: #fff;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button.secondary {
      background: #fff;
      color: var(--primary);
    }

    button:hover {
      filter: brightness(0.98);
    }

    /* üü¢ Clickable rows consistent with style guide */
    tr.project-row {
      transition: background 0.15s ease, transform 0.1s ease;
      cursor: pointer;
    }
    tr.project-row:hover {
      background: var(--secondary-blue);
      transform: translateX(2px);
    }
    td strong {
      color: var(--primary);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <a class="back-link" href="./projects.html">‚Üê Back to Project Creation</a>
      <h1>All Projects</h1>
      <a class="back-link" href="./manager-portal.html">Employees</a>
    </header>

    <div class="card">
      <div class="content">
        <div class="toolbar">
          <input id="searchBox" type="search" placeholder="Search by project name or status‚Ä¶" />
          <span id="count" class="muted">0 projects</span>
          <span style="flex:1"></span>
          <button class="secondary" onclick="window.location.href='./projects.html'">+ New Project</button>
        </div>

        <div id="tableWrap">
          <table>
            <thead>
              <tr>
                <th>Project</th>
                <th>Status</th>
                <th>Dates</th>
                <th># of Members</th>
                <th>Members</th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
          <div id="empty" class="empty" style="display:none;">No projects yet.</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      "use strict";
      const rowsEl = document.getElementById('rows');
      const emptyEl = document.getElementById('empty');
      const countEl = document.getElementById('count');
      const searchEl = document.getElementById('searchBox');

      let all = [];

      function statusClass(s){
        const k = (s || '').toLowerCase();
        if (k.includes('progress')) return 'status-in-progress';
        if (k.includes('complete')) return 'status-completed';
        return 'status-not-started';
      }

      function render(list){
        if (!list.length){
          rowsEl.innerHTML = '';
          emptyEl.style.display = '';
          countEl.textContent = '0 projects';
          return;
        }
        emptyEl.style.display = 'none';
        countEl.textContent = `${list.length} project${list.length>1?'s':''}`;

        rowsEl.innerHTML = list.map(p=>{
          const start = p.startDate ? new Date(p.startDate).toLocaleDateString() : '‚Äî';
          const end = p.endDate ? new Date(p.endDate).toLocaleDateString() : '‚Äî';
          const members = (p.members||[]).map(m=>`${m.fullName} (${m.role||'Member'})`).join(', ') || '‚Äî';

          return `
            <tr class="project-row" data-id="${p.projectID}">
              <td><strong>${p.projectName}</strong></td>
              <td><span class="badge ${statusClass(p.status)}">${p.status||'Not Started'}</span></td>
              <td>${start} <span class="muted">‚Üí</span> ${end}</td>
              <td><span class="pill">${p.teamSize||0}</span></td>
              <td>${members}</td>
            </tr>
          `;
        }).join('');

        // üü¢ Click event: open project detail page
        document.querySelectorAll('.project-row').forEach(row => {
          row.addEventListener('click', () => {
            const id = row.dataset.id;
            if (id) window.location.href = `/project-detail.html?projectID=${id}`;
          });
        });
      }

      function applySearch(){
        const q = (searchEl.value||'').toLowerCase();
        const filtered = !q ? all : all.filter(p =>
          (p.projectName||'').toLowerCase().includes(q) ||
          (p.status||'').toLowerCase().includes(q)
        );
        render(filtered);
      }

      searchEl.addEventListener('input', applySearch);

      async function init(){
        try {
          const res = await fetch('/api/projects');
          const data = await res.json();
          if(!res.ok || !data.success){ throw new Error(data.error || 'Failed to load'); }
          all = data.projects || [];
          render(all);
        } catch(err){
          console.error(err);
          rowsEl.innerHTML = '';
          emptyEl.style.display = '';
          countEl.textContent = '0 projects';
        }
      }

      init();
    })();
  </script>
</body>
</html>
